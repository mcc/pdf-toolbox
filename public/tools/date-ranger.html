<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Date Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .year-separator td {
            border-bottom: 2px solid #e2e8f0; /* slate-200 */
            padding-top: 0.5rem;
        }
        .year-subtotal td {
            border-top: 1px solid #cbd5e1; /* slate-300 */
            padding-top: 0.5rem;
            font-weight: 600;
        }
        .leap-feb {
            background-color: #f0fdf4; /* green-50 */
        }
    </style>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-xl mx-auto bg-white rounded-2xl shadow-lg p-6 md:p-8">
        
        <!-- Calculator Controls -->
        <div class="flex flex-col space-y-6">
            <h1 class="text-3xl font-bold text-slate-800">Date Calculator</h1>

            <!-- Start Date -->
            <div>
                <label for="startDate" class="block text-sm font-medium text-slate-600 mb-2">Start Date</label>
                <input type="date" id="startDate" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
            </div>

            <!-- Calculation Type -->
            <div>
                <span class="block text-sm font-medium text-slate-600 mb-2">Calculate</span>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <input type="radio" id="calcAfter" name="calcType" value="after" class="h-4 w-4 text-indigo-600 border-slate-300 focus:ring-indigo-500" checked>
                        <label for="calcAfter" class="ml-2 block text-sm text-slate-700">Date After</label>
                    </div>
                    <div class="flex items-center">
                        <input type="radio" id="calcBefore" name="calcType" value="before" class="h-4 w-4 text-indigo-600 border-slate-300 focus:ring-indigo-500">
                        <label for="calcBefore" class="ml-2 block text-sm text-slate-700">Date Before</label>
                    </div>
                </div>
            </div>

            <!-- Number of Days -->
            <div>
                <label for="numDays" class="block text-sm font-medium text-slate-600 mb-2">Number of Days</label>
                <input type="number" id="numDays" value="1" min="0" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
            </div>

            <!-- Include Today Option -->
            <div class="flex items-center">
                <input id="includeToday" name="includeToday" type="checkbox" class="h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500">
                <label for="includeToday" class="ml-2 block text-sm text-slate-700">Include start date in count</label>
            </div>

            <!-- Result Display -->
            <div class="bg-indigo-50 border-l-4 border-indigo-500 p-4 rounded-lg mt-4">
                <p class="text-sm font-medium text-indigo-700">Resulting Date:</p>
                <p id="resultDate" class="text-xl md:text-2xl font-bold text-indigo-900 mt-1">...</p>
            </div>

            <!-- Day Count Breakdown -->
            <div id="breakdownContainer" class="pt-4 border-t border-slate-200">
                <!-- Breakdown will be generated here by JS -->
            </div>
        </div>
    </div>

    <script>
        // --- DOM ELEMENT REFERENCES ---
        const startDateInput = document.getElementById('startDate');
        const calcTypeRadios = document.getElementsByName('calcType');
        const numDaysInput = document.getElementById('numDays');
        const includeTodayCheckbox = document.getElementById('includeToday');
        const resultDateElement = document.getElementById('resultDate');
        const breakdownContainer = document.getElementById('breakdownContainer');

        // --- CORE FUNCTIONS ---

        /**
         * The main function to calculate and display the resulting date and breakdown.
         */
        function calculateAndDisplayResult() {
            const startDate = new Date(startDateInput.value + 'T00:00:00');
            const numDays = parseInt(numDaysInput.value) || 0;
            const calcType = document.querySelector('input[name="calcType"]:checked').value;
            const includeToday = includeTodayCheckbox.checked;

            if (isNaN(startDate.getTime())) {
                resultDateElement.textContent = "Invalid Start Date";
                breakdownContainer.innerHTML = '';
                return;
            }

            const dayOffset = includeToday && numDays > 0 ? numDays - 1 : numDays;
            const direction = calcType === 'after' ? 1 : -1;
            const resultDate = new Date(startDate);
            resultDate.setDate(startDate.getDate() + (dayOffset * direction));

            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            resultDateElement.textContent = resultDate.toLocaleDateString('en-US', options);
            
            displayMonthBreakdown(startDate, resultDate, calcType, includeToday);
        }
        
        /**
         * Displays a detailed summary and breakdown of days per month between two dates.
         */
        function displayMonthBreakdown(startDate, resultDate, calcType, includeToday) {
            breakdownContainer.innerHTML = '';
            const numDays = parseInt(numDaysInput.value) || 0;
            if (isNaN(startDate.getTime()) || isNaN(resultDate.getTime()) || numDays === 0) {
                return;
            }

            const periodStart = calcType === 'after' ? new Date(startDate) : new Date(resultDate);
            const periodEnd = calcType === 'after' ? new Date(resultDate) : new Date(startDate);
            
            let breakdownData = [];
            let cursorDate = new Date(periodStart);

            // --- Calculate the breakdown data ---
            while (cursorDate <= periodEnd) {
                const year = cursorDate.getFullYear();
                const month = cursorDate.getMonth();
                const monthName = cursorDate.toLocaleDateString('en-US', { month: 'short' });
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                
                const isLeap = (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
                
                const startDayOfMonth = (cursorDate.getTime() === periodStart.getTime()) 
                    ? periodStart.getDate() 
                    : 1;

                const endDayOfMonth = (cursorDate.getFullYear() === periodEnd.getFullYear() && cursorDate.getMonth() === periodEnd.getMonth())
                    ? periodEnd.getDate()
                    : daysInMonth;

                let daysCount = endDayOfMonth - startDayOfMonth + 1;
                
                // The 'includeToday' logic is handled by the main offset calculation.
                // However, for the very first item in a 'before' calculation when 'includeToday' is false,
                // we need to subtract one day from the count to align with the result date.
                if (calcType === 'before' && !includeToday && cursorDate.getTime() === periodStart.getTime()) {
                    daysCount -= 1;
                }
                 if (calcType === 'after' && !includeToday && cursorDate.getTime() === periodStart.getTime()) {
                    daysCount -= 1;
                }
                
                if(daysCount > 0){
                    const isPartial = startDayOfMonth !== 1 || endDayOfMonth !== daysInMonth;
                    let label = `${year}/${monthName}`;
                    if (isPartial) {
                        label = `${monthName} ${startDayOfMonth} - ${monthName} ${endDayOfMonth}, ${year}`;
                    }

                    breakdownData.push({
                        year: year,
                        label: label,
                        count: daysCount,
                        isLeapFeb: (month === 1 && isLeap)
                    });
                }

                cursorDate.setMonth(month + 1, 1); // Move to the first day of the next month
            }
            
            if (calcType === 'before') {
                breakdownData.reverse();
            }

            // --- Render the breakdown ---
            renderBreakdown(breakdownData, periodStart, periodEnd, numDays);
        }

        /**
         * Renders the HTML for the breakdown section.
         */
        function renderBreakdown(data, periodStart, periodEnd, totalDays) {
            const heading = document.createElement('h3');
            heading.className = 'text-base font-semibold text-slate-700 mb-3';
            heading.textContent = 'Day Count Breakdown';
            breakdownContainer.appendChild(heading);

            // Render summary
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'bg-slate-50 p-3 rounded-lg mb-4 text-sm space-y-1';
            const dateOptions = { year: 'numeric', month: 'short', day: 'numeric' };
            summaryDiv.innerHTML = `
                <p><span class="font-medium text-slate-600">Date Range:</span> <span class="text-slate-800">${periodStart.toLocaleDateString('en-US', dateOptions)} to ${periodEnd.toLocaleDateString('en-US', dateOptions)}</span></p>
                <p><span class="font-medium text-slate-600">Total Days:</span> <span class="font-semibold text-indigo-600">${totalDays}</span></p>
            `;
            breakdownContainer.appendChild(summaryDiv);

            if (data.length === 0) return;

            const table = document.createElement('table');
            table.className = 'w-full text-sm';
            const tbody = document.createElement('tbody');
            table.appendChild(tbody);

            let currentYear = null;
            let yearSubtotal = 0;

            data.forEach((item, index) => {
                // Check for year change to insert separator and subtotal
                if (item.year !== currentYear && currentYear !== null) {
                    // Add subtotal for the previous year
                    tbody.innerHTML += `<tr class="year-subtotal text-slate-600"><td class="text-right pr-4 py-1">Subtotal for ${currentYear}</td><td class="w-24 text-center font-mono py-1">${yearSubtotal}</td></tr>`;
                    // Add separator
                    tbody.innerHTML += `<tr class="year-separator"><td colspan="2"></td></tr>`;
                    yearSubtotal = 0;
                }
                currentYear = item.year;
                yearSubtotal += item.count;

                // Add the main row for the month/period
                const row = document.createElement('tr');
                if (item.isLeapFeb) {
                    row.className = 'leap-feb';
                }
                row.innerHTML = `
                    <td class="p-2 text-slate-700">
                        ${item.label}
                        ${item.isLeapFeb ? '<span class="text-green-600 font-semibold text-xs ml-1" title="Leap Year">✦</span>' : ''}
                    </td>
                    <td class="w-24 p-2 font-mono font-semibold text-slate-800 text-center">${item.count}</td>
                `;
                tbody.appendChild(row);
            });
            
            // Add the final subtotal for the last year in the list
            tbody.innerHTML += `<tr class="year-subtotal text-slate-600"><td class="text-right pr-4 py-1">Subtotal for ${currentYear}</td><td class="w-24 text-center font-mono py-1">${yearSubtotal}</td></tr>`;

            breakdownContainer.appendChild(table);
        }


        // --- INITIALIZATION AND EVENT LISTENERS ---
        function initialize() {
            const today = new Date();
            startDateInput.value = today.toISOString().split('T')[0];
            calculateAndDisplayResult();
            [startDateInput, numDaysInput, includeTodayCheckbox, ...calcTypeRadios].forEach(el => {
                el.addEventListener('change', calculateAndDisplayResult);
                if (el.type === 'number') el.addEventListener('input', calculateAndDisplayResult);
            });
        }

        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
